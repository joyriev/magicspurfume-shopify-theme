{% liquid
  assign product_form_id = 'product-form-' | append: section.id
  assign selected_variant = product.selected_or_first_available_variant
%}

{% if product.metafields.custom.inspiration != blank %}
  <div class="flex items-center gap-2 mb-3">
    <img
      class="object-contain object-center bg-white"
      src="{{ product.metafields.custom.inspiration.value.image |  image_url }}"
      alt="{{ product.metafields.custom.inspiration.value.image.alt | escape }}"
      width="45"
      height="45">
    <div>
      <p class="text-sm my-0">Inspiriert von:</p>
      <h4 class="font-semibold my-0 line-clamp-1">{{ product.metafields.custom.inspiration.value.name }}</h4>
    </div>
  </div>
{% endif %}
<div>
  {% if product.metafields.custom.original_retail_price != blank %}
    <div>(RRP: {{ product.metafields.custom.original_retail_price.value | money }})</div>
  {% endif %}
  {% if product.metafields.custom.scent_intensity != blank %}
    <div class="flex items-center gap-[5px]">
      Duftintensit√§t:
      <span class="text-highlight leading-4">Statement</span>
      {% assign intensity = product.metafields.custom.scent_intensity.value | times: 1 %}
      <div class="flex gap-[5px] items-center justify-center ml-1">
        {% for i in (1..3) %}
          <div class="w-[8px] h-[8px] rounded-full {% if i <= intensity %}bg-black{% else %}bg-gray-300{% endif %} !inline-block"></div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
</div>

<div>
  <div class="inline-flex items-center gap-2 px-2 py-1 rounded-full bg-white font-semibold">
    <img
      src="https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg"
      alt="üá™üá∫"
      height="20"
      width="20"
      class="object-cover size-5 rounded-full">
    <span>Hergestellt in der EU</span>
  </div>
</div>

{% assign selling_points = product.metafields.custom.bullets.value %}
{% if selling_points %}
  <ul class="list-none pl-0">
    {% for point in selling_points %}
      <li>‚úÖ {{ point }}</li>
    {% endfor %}
  </ul>
{% endif %}

{% if product.variants.size > 1 %}
  {% comment %} Variant Selector {% endcomment %}
  <div class="flex justify-between items-center mb-3 !mt-6">
    <h2 class="m-0 text-base font-semibold">Gr√∂√üe ausw√§hlen:</h2>
    <div class="text-sm italic text-gray-500">80 % unserer Kunden kaufen 50 ml oder mehr</div>
  </div>

  <div class="flex gap-3" id="variant-selector">
    {% for variant in product.variants %}
      {% assign size = variant.title | remove: 'ml' %}
      {% assign size_int = size | times: 1 %}
      {% assign price_in_dollars = variant.price | times: 0.01 %}
      {% assign per_ml = price_in_dollars | divided_by: size_int | round: 2 %}
      <button
        type="button"
        class="variant-button flex-grow flex md:flex-col items-center gap-2 rounded-lg p-2 pt-3 bg-white border-2 border-solid cursor-pointer font-['Plus_Jakarta_Sans'] relative {% if variant.id == selected_variant.id %}border-black{% else %}border-gray-200{% endif %}"
        data-variant-id="{{ variant.id }}"
        data-variant-title="{{ variant.title }}"
        data-original-price="{{ variant.price | money }}"
        data-compare-price="{{ variant.compare_at_price | money }}">
        <div class="text-center">
          <div class="text-base font-semibold">{{ variant.title }}</div>
          <div class="text-xs text-gray-600">
            {{- cart.currency.symbol -}}
            {{- per_ml }} Pro Spr√ºhsto√ü</div>
        </div>
        {% if variant.title == '50ml' %}
          <span class="text-xs italic text-white rounded absolute -top-2.5 left-1/2 [transform:translateX(-50%)] bg-[#c8202f] px-2 py-0.5">Beliebt</span>
        {% endif %}
        {% if variant.title == '100ml' %}
          <span class="text-xs italic text-white rounded absolute -top-2.5 left-1/2 [transform:translateX(-50%)] bg-[#22613a] px-2 py-0.5">Bestseller</span>
        {% endif %}
      </button>
    {% endfor %}
  </div>
{% endif %}

{% comment %} Add to cart form {% endcomment %}
<product-form
  class="product-form !m-0"
  data-hide-errors="{{ gift_card_recipient_feature_active }}"
  data-section-id="{{ section.id }}">
  {%- form 'product'
    , product
    , id: product_form_id
    , class: 'form'
    , novalidate: 'novalidate'
    , data-type: 'add-to-cart-form'
  -%}
    <input
      type="hidden"
      name="id"
      id="product-variant-id"
      value="{{ selected_variant.id }}"
      class="product-variant-id">
    <button
      type="submit"
      name="add"
      value="1"
      class="atc-button cta_product_from_submit_btn flex flex-wrap items-center !mb-0 text-2xl !pb-3 !pt-3 rounded-lg button bg-black transition-colors shadow-xl tracking-normal button--full-width button--primary"
      aria-label="Add to cart"
      {% if product.metafields.custom.choose_your_fragrances_options != blank %}
      disabled="disabled"
      {% endif %}>
      <span>In den Warenkorb</span>
      <div class="ml-2 pl-2 border-0 border-l flex items-center border-solid border-gray-200/20">
        <div
          class="inline-block text-lg bg-gray-800 px-3 rounded"
          id="product-price"
          role="status"
          {{ block.shopify_attributes }}>
          {% if selected_variant.compare_at_price > selected_variant.price %}
            <span class="compare-price line-through text-white/50 text-base">{{ selected_variant.compare_at_price | money }}</span>
          {% endif %}
          <span class="current-price">{{ selected_variant.price | money }}</span>
        </div>
      </div>
      {%- render 'loading-spinner' -%}
    </button>
  {%- endform -%}
</product-form>

<script>
  (function() {
    // Variant data object
    const variantsData = {
      {% for variant in product.variants %}
        "{{ variant.id }}": {
          title: "{{ variant.title }}",
          originalPrice: "{{ variant.price | money }}",
          compareAtPrice: "{{ variant.compare_at_price | money }}",
          hasComparePrice: {% if variant.compare_at_price > variant.price %}true{% else %}false{% endif %}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    };

    // State
    let selectedVariantId = "{{ selected_variant.id }}";

    // DOM elements
    const variantButtons = document.querySelectorAll('.variant-button');
    const variantIdInput = document.getElementById('product-variant-id');
    const priceContainer = document.getElementById('product-price');
    const comparePriceSpan = priceContainer.querySelector('.compare-price');
    const currentPriceSpan = priceContainer.querySelector('.current-price');

    // Update variant selection
    function updateVariant(variantId) {
      selectedVariantId = variantId;
      const variantData = variantsData[variantId];

      // Update hidden input
      variantIdInput.value = variantId;

      // Update button styles
      variantButtons.forEach(button => {
        if (button.dataset.variantId === variantId) {
          button.classList.add('border-black');
          button.classList.remove('border-gray-200');
        } else {
          button.classList.remove('border-black');
          button.classList.add('border-gray-200');
        }
      });

      // Update price display
      if (variantData.hasComparePrice) {
        if (!comparePriceSpan) {
          const newCompareSpan = document.createElement('span');
          newCompareSpan.className = 'compare-price line-through text-white/50 text-base';
          priceContainer.insertBefore(newCompareSpan, currentPriceSpan);
        }
        const compareSpan = priceContainer.querySelector('.compare-price');
        compareSpan.innerHTML = variantData.compareAtPrice;
        compareSpan.style.display = '';
      } else {
        if (comparePriceSpan) {
          comparePriceSpan.style.display = 'none';
        }
      }

      currentPriceSpan.innerHTML = variantData.originalPrice;
    }

    // Add click event listeners to variant buttons
    variantButtons.forEach(button => {
      button.addEventListener('click', function() {
        const variantId = this.dataset.variantId;
        updateVariant(variantId);
      });
    });
  })();
</script>

<div class="my-6">
  <div class="flex items-center gap-3 text-base">
    <img
      src="https://cdn.shopify.com/s/files/1/0623/0691/0402/files/thimbs_up.png?v=1751372431"
      alt="Thumbs up badge"
      class="w-10 h-10 flex-shrink-0"
      width="40"
      height="40" />
    <div class="text-slate-900">
      <strong class="font-semibold">Teste es 60 Tage lang ‚Äì v√∂llig risikofrei.</strong>
      <div class="[display:none] md:block">Sollten Sie nicht absolut begeistert sein, erstatten wir Ihnen den vollen Betrag zur√ºck!</div>
    </div>
  </div>
</div>